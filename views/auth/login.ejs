<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../partials/head'); %>
</head>

<body>

    <div class="bg-dark">
        <header class="container pt-4 pb-4">
            <%- include('../partials/header'); %>
        </header>

        <section class="container py-5 text-light" style="display: flex; justify-content: center;flex-direction: column;
         align-items: center;">
            <h1 class="pt-3">Login</h1>
            <h5 class="pt-4 pb-4 w-50 text-center">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Labore hic
                ducimus
                illo laborum praesentium
                pariatur aut laudantium sint, similique, qui possimus officia earum nulla dolorem ullam voluptate sequi
                eveniet distinctio.</h5>
        </section>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
            <path fill="#fff" fill-opacity="1" d="M0,0L480,128L960,32L1440,256L1440,320L960,320L480,320L0,320Z">
            </path>
        </svg>
    </div>

    <main class="container pb-5 mb-5">
        <div class="w-50 m-auto">

            <h1>Login</h1>
            <br />

            <form class="form" method="post">
                <div class="form-group">
                    <label for="name">Name</label>
                    <input type="text" class="form-control" name="name" id="name" aria-describedby="helpId"
                        placeholder="Full name">
                    <small id="helpId" class="form-text text-muted">Enter full name</small>
                </div>
                <div class="form-group mt-2">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" name="email" id="email" aria-describedby="email"
                        placeholder="Email">
                    <small id="helpId" class="form-text text-muted">Enter a valid email address</small>
                </div>
                <div class="form-group mt-2">
                    <label for="vin-number">Vehicle Identification Number</label>
                    <input type="text" min="10" class="form-control" name="vinNumber" value="5NPDH4AE2CH063670"
                        id="vinNumber" aria-describedby="vinNumber" placeholder="VI number">
                    <small id="helpId" class="form-text text-muted">Enter a valid VI number</small>
                </div>
                <div class="form-group mt-2">
                    <label for="insuranceType">Vehicle Identification Number</label>
                    <select class="form-control" name="insuranceType" id="insuranceType">
                        <option value="select">Select insurance type</option>
                        <option value="information">Vehicle Information History</option>
                        <option value="history">Vehicle History Specification</option>
                        <option value="both">Vehicle Information + History</option>
                    </select>
                    <small id="helpId" class="form-text text-muted">Select the type of report you want to
                        generate</small>

                </div>
                <div class="form-group mt-2">
                    <label for="insurancePrice">Insurance Price</label>
                    <select class="form-control" name="insurancePrice" id="insurancePrice">
                        <option value="select">Select insurance price</option>
                        <option value="25">25$</option>
                        <option value="50">50$</option>
                        <option value="75">75$</option>
                    </select>
                    <small id="helpId" class="form-text text-muted">You can see the comparision on the reports
                        page.</small>

                </div>

                <button type="submit" class="btn btn-dark mt-3 w-100">Submit</button>

            </form>
        </div>

    </main>



    <footer>
        <%- include('../partials/footer'); %>
            <script>

                const form = document.querySelector('.form');

                const name = document.querySelector('#name');
                const email = document.querySelector('#email');
                const vinNumber = document.querySelector('#vinNumber');
                const insuranceType = document.querySelector('#insuranceType');
                const insurancePrice = document.querySelector('#insurancePrice');


                const checkInputs = function () {
                    validation = false;

                    if (name.value === "") {
                        name.style.border = "1px solid red";
                        validation = true;
                    }
                    else {
                        name.style.border = "1px solid #ced4da";
                    }
                    if (email.value === "") {
                        email.style.border = "1px solid red";
                        validation = true;
                    }
                    else {
                        email.style.border = "1px solid #ced4da";
                    }
                    if (vinNumber.value === "") {
                        vinNumber.style.border = "1px solid red";
                        validation = true;
                    }
                    else {
                        vinNumber.style.border = "1px solid #ced4da";
                    }
                    if (insuranceType.value === "select") {
                        insuranceType.style.border = "1px solid red";
                        validation = true;
                    }
                    else {
                        insuranceType.style.border = "1px solid #ced4da";
                    }
                    if (insurancePrice.value === "select") {
                        insurancePrice.style.border = "1px solid red";
                        validation = true;
                    }
                    else {
                        insurancePrice.style.border = "1px solid #ced4da";
                    }

                    return validation;
                }

                const showAlert = function (msg) {
                    const alert = document.createElement('div');
                    alert.className = "alert alert-danger";
                    alert.textContent = msg;
                    form.prepend(alert);
                    setTimeout(() => {
                        alert.remove();
                    }, 3000);
                }


                form.addEventListener("submit", async function (e) {
                    e.preventDefault();
                    if (checkInputs()) {
                        showAlert("Please fill in all fields");
                    }
                    else {
                        const data = {
                            name: name.value,
                            email: email.value,
                            vinNumber: vinNumber.value,
                            insuranceType: insuranceType.value,
                            insurancePrice: insurancePrice.value
                        }

                        console.log(data);

                        const response = await fetch("/fetch-report", {
                            method: "POST",

                            body: JSON.stringify(data),
                            headers: {
                                "Content-type": "application/json; charset=UTF-8"
                            }
                        }).then((res) => res.json());

                        if (response?.msg === "Invalid VIN Number") {
                            showAlert("Invalid VIN Number")
                            localStorage.setItem("report-loaded", false);

                        }
                        else {

                            const _response = {
                                ...response,
                                ...data,
                            }
                            localStorage.setItem("report", JSON.stringify(_response));
                            localStorage.setItem("report-loaded", true);
                            window.location.href = "/report";
                        }

                        // form.submit();
                    }

                })
            </script>
    </footer>

</body>

</html>